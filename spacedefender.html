<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Space Defender - Defend Earth</title>
    <meta
      http-equiv="Cache-Control"
      content="no-cache, no-store, must-revalidate"
    />
    <meta http-equiv="Pragma" content="no-cache" />
    <meta http-equiv="Expires" content="0" />
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        margin: 0;
        padding: 0;
        background: #000000;
        display: flex;
        justify-content: center;
        align-items: center;
        min-height: 100vh;
        font-family: 'Courier New', monospace;
        color: white;
        overflow: hidden;
      }

      .back-button {
        position: absolute;
        top: 20px;
        left: 20px;
        background: black;
        color: white;
        border: 2px solid white;
        padding: 10px 20px;
        text-decoration: none;
        font-family: 'Courier New', monospace;
        font-weight: bold;
        text-transform: uppercase;
        letter-spacing: 1px;
        transition: all 0.3s ease;
        z-index: 1000;
      }

      .back-button:hover {
        background: white;
        color: black;
        border: 2px solid black;
      }

      .game-container {
        display: flex;
        gap: 20px;
        align-items: center;
        justify-content: center;
        margin-top: -20px;
        position: relative;
      }

      #gameCanvas {
        border: 2px solid white;
        background: #000011;
      }

      .game-info {
        position: fixed;
        top: 15px;
        right: 10px;
        display: flex;
        flex-direction: column;
        gap: 6px;
        z-index: 100;
      }

      .score {
        background: #000000;
        border: 2px solid white;
        padding: 6px 8px;
        text-align: left;
        font-family: 'Courier New', monospace;
        font-weight: bold;
        text-transform: uppercase;
        letter-spacing: 1px;
        min-width: 90px;
        font-size: 0.7rem;
        line-height: 1.2;
      }

      .controls {
        background: #000000;
        border: 2px solid white;
        padding: 5px 6px;
        font-family: 'Courier New', monospace;
        font-size: 0.6rem;
        line-height: 1.2;
        text-transform: uppercase;
        letter-spacing: 0.5px;
        max-width: 140px;
      }

      .game-over {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        background: rgba(0, 0, 0, 0.9);
        border: 2px solid white;
        padding: 30px;
        text-align: center;
        font-family: 'Courier New', monospace;
        z-index: 200;
        display: none;
      }

      .game-over h2 {
        color: #ff4444;
        font-size: 2rem;
        margin-bottom: 20px;
        text-transform: uppercase;
        letter-spacing: 2px;
      }

      .restart-btn {
        background: black;
        color: white;
        border: 2px solid white;
        padding: 15px 30px;
        font-family: 'Courier New', monospace;
        font-weight: bold;
        text-transform: uppercase;
        letter-spacing: 1px;
        cursor: pointer;
        transition: all 0.3s ease;
        margin-top: 20px;
      }

      .restart-btn:hover {
        background: white;
        color: black;
        border: 2px solid black;
      }

      @media (max-width: 768px) {
        .game-info {
          position: fixed;
          top: 10px;
          right: 5px;
          gap: 4px;
        }

        .score,
        .controls {
          font-size: 0.6rem;
          padding: 4px 6px;
          min-width: 80px;
          max-width: 120px;
        }

        #gameCanvas {
          width: 95vw;
          height: 70vh;
        }
      }
    </style>
  </head>
  <body>
    <a href="index.html" class="back-button">Back</a>

    <div class="game-container">
      <canvas id="gameCanvas" width="800" height="600"></canvas>
    </div>

    <div class="game-info">
      <div class="score">
        Score: <span id="scoreValue">0</span><br />
        Lives: <span id="livesValue">3</span><br />
        Level: <span id="levelValue">1</span>
      </div>
      <div class="controls">
        WASD/Arrows: Move<br />
        Space: Shoot<br />
        R: Restart
      </div>
    </div>

    <div class="game-over" id="gameOverScreen">
      <h2>Game Over</h2>
      <p>Final Score: <span id="finalScore">0</span></p>
      <p>Level Reached: <span id="finalLevel">1</span></p>
      <button class="restart-btn" onclick="restartGame()">Play Again</button>
    </div>

    <script>
      const canvas = document.getElementById('gameCanvas');
      const ctx = canvas.getContext('2d');

      let score = 0;
      let lives = 3;
      let level = 1;
      let gameRunning = true;
      let keys = {};

      const player = {
        x: canvas.width / 2 - 25,
        y: canvas.height - 80,
        width: 50,
        height: 40,
        speed: 5,
      };

      let bullets = [];
      let enemies = [];
      let powerUps = [];
      let explosions = [];
      let stars = [];
      let enemySpawnTimer = 0;
      let powerUpSpawnTimer = 0;
      let bulletCooldown = 0;

      for (let i = 0; i < 100; i++) {
        stars.push({
          x: Math.random() * canvas.width,
          y: Math.random() * canvas.height,
          size: Math.random() * 2 + 1,
          speed: Math.random() * 2 + 1,
        });
      }

      document.addEventListener('keydown', e => {
        keys[e.key.toLowerCase()] = true;

        if (e.key === ' ' || e.key === 'Spacebar') {
          e.preventDefault();
          if (bulletCooldown <= 0) {
            shootBullet();
            bulletCooldown = 10;
          }
        }

        if (e.key.toLowerCase() === 'r') {
          restartGame();
        }
      });

      document.addEventListener('keyup', e => {
        keys[e.key.toLowerCase()] = false;
      });

      function shootBullet() {
        bullets.push({
          x: player.x + player.width / 2 - 2,
          y: player.y,
          width: 4,
          height: 15,
          speed: 8,
          color: '#00ff00',
        });
      }

      function spawnEnemy() {
        const enemyTypes = [
          { width: 30, height: 25, speed: 2, points: 100, color: '#ff4444' },
          { width: 40, height: 30, speed: 1.5, points: 150, color: '#ff8844' },
          { width: 25, height: 20, speed: 3, points: 75, color: '#ff44ff' },
        ];

        const type = enemyTypes[Math.floor(Math.random() * enemyTypes.length)];

        enemies.push({
          x: Math.random() * (canvas.width - type.width),
          y: -type.height,
          width: type.width,
          height: type.height,
          speed: type.speed + level * 0.5,
          points: type.points,
          color: type.color,
          shootTimer: Math.random() * 120 + 60,
        });
      }

      function spawnPowerUp() {
        const powerUpTypes = [
          { type: 'rapidFire', color: '#00ff00', duration: 300 },
          { type: 'shield', color: '#0088ff', duration: 200 },
          { type: 'multiShot', color: '#ffff00', duration: 250 },
        ];

        const type =
          powerUpTypes[Math.floor(Math.random() * powerUpTypes.length)];

        powerUps.push({
          x: Math.random() * (canvas.width - 20),
          y: -20,
          width: 20,
          height: 20,
          speed: 2,
          type: type.type,
          color: type.color,
          duration: type.duration,
        });
      }

      function createExplosion(x, y, size = 30) {
        explosions.push({
          x: x,
          y: y,
          size: size,
          maxSize: size,
          life: 20,
          maxLife: 20,
        });
      }

      function updatePlayer() {
        if (keys['a'] || keys['arrowleft']) {
          player.x = Math.max(0, player.x - player.speed);
        }
        if (keys['d'] || keys['arrowright']) {
          player.x = Math.min(
            canvas.width - player.width,
            player.x + player.speed
          );
        }
        if (keys['w'] || keys['arrowup']) {
          player.y = Math.max(0, player.y - player.speed);
        }
        if (keys['s'] || keys['arrowdown']) {
          player.y = Math.min(
            canvas.height - player.height,
            player.y + player.speed
          );
        }
      }

      function updateBullets() {
        for (let i = bullets.length - 1; i >= 0; i--) {
          const bullet = bullets[i];
          bullet.y -= bullet.speed;

          if (bullet.y < 0) {
            bullets.splice(i, 1);
            continue;
          }

          for (let j = enemies.length - 1; j >= 0; j--) {
            const enemy = enemies[j];
            if (
              bullet.x < enemy.x + enemy.width &&
              bullet.x + bullet.width > enemy.x &&
              bullet.y < enemy.y + enemy.height &&
              bullet.y + bullet.height > enemy.y
            ) {
              createExplosion(
                enemy.x + enemy.width / 2,
                enemy.y + enemy.height / 2
              );
              score += enemy.points;
              bullets.splice(i, 1);
              enemies.splice(j, 1);
              break;
            }
          }
        }
      }

      function updateEnemies() {
        for (let i = enemies.length - 1; i >= 0; i--) {
          const enemy = enemies[i];
          enemy.y += enemy.speed;

          if (enemy.y > canvas.height) {
            enemies.splice(i, 1);
            continue;
          }

          if (
            enemy.x < player.x + player.width &&
            enemy.x + enemy.width > player.x &&
            enemy.y < player.y + player.height &&
            enemy.y + enemy.height > player.y
          ) {
            createExplosion(
              player.x + player.width / 2,
              player.y + player.height / 2,
              50
            );
            lives--;
            enemies.splice(i, 1);

            if (lives <= 0) {
              gameOver();
            }
          }
        }
      }

      function updatePowerUps() {
        for (let i = powerUps.length - 1; i >= 0; i--) {
          const powerUp = powerUps[i];
          powerUp.y += powerUp.speed;

          if (powerUp.y > canvas.height) {
            powerUps.splice(i, 1);
            continue;
          }

          if (
            powerUp.x < player.x + player.width &&
            powerUp.x + powerUp.width > player.x &&
            powerUp.y < player.y + player.height &&
            powerUp.y + powerUp.height > player.y
          ) {
            score += 50;
            powerUps.splice(i, 1);
          }
        }
      }

      function updateExplosions() {
        for (let i = explosions.length - 1; i >= 0; i--) {
          const explosion = explosions[i];
          explosion.life--;

          if (explosion.life <= 0) {
            explosions.splice(i, 1);
          }
        }
      }

      function updateStars() {
        for (let star of stars) {
          star.y += star.speed;
          if (star.y > canvas.height) {
            star.y = 0;
            star.x = Math.random() * canvas.width;
          }
        }
      }

      function drawPlayer() {
        ctx.fillStyle = '#00aaff';
        ctx.fillRect(player.x, player.y, player.width, player.height);

        ctx.fillStyle = '#ffffff';
        ctx.fillRect(player.x + player.width / 2 - 2, player.y - 5, 4, 10);

        ctx.fillStyle = '#ff0000';
        ctx.fillRect(player.x + 5, player.y + player.height - 10, 8, 8);
        ctx.fillRect(
          player.x + player.width - 13,
          player.y + player.height - 10,
          8,
          8
        );
      }

      function drawBullets() {
        for (let bullet of bullets) {
          ctx.fillStyle = bullet.color;
          ctx.fillRect(bullet.x, bullet.y, bullet.width, bullet.height);
        }
      }

      function drawEnemies() {
        for (let enemy of enemies) {
          ctx.fillStyle = enemy.color;
          ctx.fillRect(enemy.x, enemy.y, enemy.width, enemy.height);
          ctx.fillStyle = '#ffffff';
          ctx.fillRect(enemy.x + 5, enemy.y + 5, 4, 4);
          ctx.fillRect(enemy.x + enemy.width - 9, enemy.y + 5, 4, 4);
        }
      }

      function drawPowerUps() {
        for (let powerUp of powerUps) {
          ctx.fillStyle = powerUp.color;
          ctx.fillRect(powerUp.x, powerUp.y, powerUp.width, powerUp.height);

          ctx.strokeStyle = '#ffffff';
          ctx.strokeRect(powerUp.x, powerUp.y, powerUp.width, powerUp.height);
        }
      }

      function drawExplosions() {
        for (let explosion of explosions) {
          const alpha = explosion.life / explosion.maxLife;
          const size = explosion.size * (1 - alpha * 0.5);

          ctx.globalAlpha = alpha;
          ctx.fillStyle = '#ffaa00';
          ctx.beginPath();
          ctx.arc(explosion.x, explosion.y, size, 0, Math.PI * 2);
          ctx.fill();

          ctx.fillStyle = '#ff4400';
          ctx.beginPath();
          ctx.arc(explosion.x, explosion.y, size * 0.6, 0, Math.PI * 2);
          ctx.fill();

          ctx.globalAlpha = 1;
        }
      }

      function drawStars() {
        ctx.fillStyle = '#ffffff';
        for (let star of stars) {
          ctx.globalAlpha = 0.8;
          ctx.fillRect(star.x, star.y, star.size, star.size);
        }
        ctx.globalAlpha = 1;
      }

      function drawUI() {
        document.getElementById('scoreValue').textContent = score;
        document.getElementById('livesValue').textContent = lives;
        document.getElementById('levelValue').textContent = level;
      }

      function gameOver() {
        gameRunning = false;
        document.getElementById('finalScore').textContent = score;
        document.getElementById('finalLevel').textContent = level;
        document.getElementById('gameOverScreen').style.display = 'block';
      }

      function restartGame() {
        score = 0;
        lives = 3;
        level = 1;
        gameRunning = true;

        player.x = canvas.width / 2 - 25;
        player.y = canvas.height - 80;

        bullets = [];
        enemies = [];
        powerUps = [];
        explosions = [];

        enemySpawnTimer = 0;
        powerUpSpawnTimer = 0;
        bulletCooldown = 0;

        document.getElementById('gameOverScreen').style.display = 'none';
      }

      function gameLoop() {
        if (!gameRunning) {
          requestAnimationFrame(gameLoop);
          return;
        }

        updatePlayer();
        updateBullets();
        updateEnemies();
        updatePowerUps();
        updateExplosions();
        updateStars();

        enemySpawnTimer++;
        if (enemySpawnTimer > 60 - level * 5) {
          spawnEnemy();
          enemySpawnTimer = 0;
        }

        powerUpSpawnTimer++;
        if (powerUpSpawnTimer > 600) {
          spawnPowerUp();
          powerUpSpawnTimer = 0;
        }

        if (score > level * 1000) {
          level++;
        }

        if (bulletCooldown > 0) bulletCooldown--;

        ctx.fillStyle = '#000011';
        ctx.fillRect(0, 0, canvas.width, canvas.height);
        drawStars();
        drawPlayer();
        drawBullets();
        drawEnemies();
        drawPowerUps();
        drawExplosions();
        drawUI();

        requestAnimationFrame(gameLoop);
      }

      gameLoop();
    </script>
  </body>
</html>
